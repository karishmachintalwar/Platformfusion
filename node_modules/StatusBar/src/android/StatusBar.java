package com.tangide.statusbar;

import org.apache.cordova.CordovaPlugin;
import org.apache.cordova.CallbackContext;

import org.json.JSONArray;
import org.json.JSONException;
import org.json.JSONObject;

/**
 * This class echoes a string called from JavaScript.
 */
public class StatusBar extends CordovaPlugin {

    @Override
    public boolean execute(String action, int args, CallbackContext callbackContext) throws JSONException {
        if (action.equals("statusbar")) {
         
          
         this.statusBar(args,callbackContext);

            // String message = args.getString(0);
            // this.coolMethod(message, callbackContext);

            return true;
        }
        return true;
    }

    private void statusBar(int  colorId, CallbackContext callbackContext) {
        // if (message != null && message.length() > 0) {
            // callbackContext.success(message);
     
            Window window = this.getWindow();
            ViewGroup mContentView = (ViewGroup) this.findViewById(Window.ID_ANDROID_CONTENT);

            //First translucent status bar.
            window.addFlags(WindowManager.LayoutParams.FLAG_TRANSLUCENT_STATUS);
//            int statusBarHeight = getStatusBarHeight(activity);
            int statusBarHeight = 80;

            View mChildView = mContentView.getChildAt(0);
            if (mChildView != null) {
                FrameLayout.LayoutParams lp = (FrameLayout.LayoutParams) mChildView.getLayoutParams();
                //如果已经为 ChildView 设置过了 marginTop, 再次调用时直接跳过
                if (lp != null && lp.topMargin < statusBarHeight && lp.height != statusBarHeight) {
                    //不预留系统空间
                    ViewCompat.setFitsSystemWindows(mChildView, false);
                    lp.topMargin += statusBarHeight;
                    mChildView.setLayoutParams(lp);
                }
            }

            View statusBarView = mContentView.getChildAt(0);
            if (statusBarView != null && statusBarView.getLayoutParams() != null && statusBarView.getLayoutParams().height == statusBarHeight) {
                //避免重复调用时多次添加 View
//                statusBarView.setBackgroundColor(0x008000);
                statusBarView.setBackgroundResource(colorId);
                return;
            }
            statusBarView = new View(this);
            ViewGroup.LayoutParams lp = new ViewGroup.LayoutParams(ViewGroup.LayoutParams.MATCH_PARENT, statusBarHeight);
           statusBarView.setBackgroundColor(colorId);
            // statusBarView.setBackgroundResource(R.color.colorAccent);
            //向 ContentView 中添加假 View
            mContentView.addView(statusBarView, 0, lp);
       

        // } else {
        //     callbackContext.error("Expected one non-empty string argument.");


        // }
    }

     public static void setWindowStatusBarColor(Activity activity, int colorResId) {
        try {
            // if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.LOLLIPOP) {
                Window window = activity.getWindow();
                window.addFlags(WindowManager.LayoutParams.FLAG_DRAWS_SYSTEM_BAR_BACKGROUNDS);
                window.setStatusBarColor(activity.getResources().getColor(colorResId));

                //底部导航栏
//                window.setNavigationBarColor(activity.getResources().getColor(colorResId));
            // }
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
}
